{% extends "navbar.html" %}
{% block top %}
<style>
    body { background:#060606; color:#e5e5e5; }
    .admin-wrapper { display:flex; margin-top:70px; min-height: calc(100vh - 70px); }
    .admin-sidebar { width:220px; background:#0c0c0c; border-right:1px solid #1c1c1c; padding:18px 14px; }
    .sidebar-title { font-size:20px; font-weight:700; margin:0 0 18px 2px; color:#e8e8e8; }
    .sidebar-nav { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:6px; }
    .sidebar-nav a { display:flex; align-items:center; gap:10px; padding:9px 10px; color:#d0d0d0; text-decoration:none; background:#111; border:1px solid #1f1f1f; border-radius:4px; transition:background .15s ease,color .15s ease, border .15s ease;}
    .sidebar-nav a:hover { background:#181818; color:#fff; border-color:#2a2a2a; }
    .sidebar-nav a.active { background:#202020; color:#fff; border-color:#3a3a3a; }
    .admin-content { flex:1; padding:0 24px 32px 24px; }
    .card { background:#0f0f0f; border:1px solid #1f1f1f; border-radius:4px; padding:14px 16px; margin-bottom:18px; }
    .muted { color:#9a9a9a; font-size:13px; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px 10px; border-bottom:1px solid #1d1d1d; font-size:13px; }
    thead tr { background:#262626; }
    tbody tr:nth-child(2n) { background:#0c0c0c; }
    tbody tr:nth-child(2n+1) { background:#121212; }
    @media(max-width:900px){ .admin-wrapper{flex-direction:column;} .admin-sidebar{width:100%; border-right:none; border-bottom:1px solid #1c1c1c;} }
</style>
{% endblock %}

{% block bottom %}
<div class="admin-wrapper">
    <aside class="admin-sidebar">
        <div class="sidebar-title">ADMIN</div>
        <div class="muted" style="margin-bottom:12px;">Menu</div>
        <ul class="sidebar-nav">
            <li><a href="{{ url_for('index') }}"><span class="fa fa-home"></span>Home</a></li>
            <li><a href="{{ url_for('admin_dashboard') }}"><span class="fa fa-home"></span>HOA</a></li>
            <li><a href="{{ url_for('users') }}"><span class="fa fa-user"></span>Users</a></li>
            <li><a href="{{ url_for('admin_blacklist') }}"><span class="fa fa-ban"></span>Blacklist</a></li>
            <li><a href="{{ url_for('admin_flags') }}"><span class="fa fa-flag"></span>Flags</a></li>
            <li><a href="{{ url_for('admin_edits') }}"><span class="fa fa-edit"></span>Edits</a></li>
            <li><a href="{{ url_for('admin_logs') }}"><span class="fa fa-list"></span>Logs</a></li>
            <li><a class="active" href="{{ url_for('admin_gifts') }}"><span class="fa fa-gift"></span>Gifts</a></li>
            <li><a href="{{ url_for('admin_spam') }}"><span class="fa fa-bell-slash"></span>Chat Mutes</a></li>
            <li><a href="{{ url_for('admin_chat') }}"><span class="fa fa-commenting"></span>Chat</a></li>
            <li><a href="{{ url_for('admin_announcements') }}"><span class="fa fa-bullhorn"></span>Announcements</a></li>
            <li><a href="{{ url_for('settings') }}"><span class="fa fa-toggle-on"></span>Settings</a></li>
        </ul>
    </aside>

    <div class="admin-content">
        <div class="card">
            <h3 style="margin:0 0 6px 0;">Create / Update Gift Code</h3>
            <div class="muted">Выберите тип награды: роль/тег или произвольный текст. Лимит использований и дата истечения опциональны.</div>
            {% if message %}<div style="margin-top:8px;color:#2bd82b;">{{ message }}</div>{% endif %}
            <form method="post" id="gift-form" class="form-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:10px;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <input name="code" placeholder="Code" required>
                <select id="reward_type" style="width:100%;padding:8px;background:#111;border:1px solid #1f1f1f;color:#e5e5e5;">
                    <option value="text" selected>Custom text / description</option>
                    <option value="role_admin">Role: Admin</option>
                    <option value="role_founder">Role: Founder</option>
                    <option value="role_manager">Role: Manager</option>
                    <option value="role_mod">Role: Mod</option>
                    <option value="role_council">Role: Council</option>
                    <option value="role_helper">Role: Helper</option>
                    <option value="role_rich">Role: Rich</option>
                    <option value="role_vip">Role: VIP</option>
                    <option value="tag_custom">Custom tag (enter below)</option>
                </select>
                <input id="reward_custom" name="reward" placeholder="Reward/description (auto-filled for roles)" style="grid-column:1/-1;">
                <input name="max_uses" type="number" min="1" value="1" placeholder="Max uses">
                <input name="expires_at" placeholder="Expires at (YYYY-MM-DD)">
                <button class="btn" type="submit" style="grid-column:1/-1;max-width:160px;">Save</button>
            </form>
            <script>
                const rewardType = document.getElementById('reward_type');
                const rewardCustom = document.getElementById('reward_custom');
                rewardType.addEventListener('change', () => {
                    const v = rewardType.value;
                    if(v.startsWith('role_')){
                        rewardCustom.value = 'role:' + v.replace('role_','');
                    } else if(v === 'tag_custom'){
                        rewardCustom.value = 'tag:';
                        rewardCustom.focus();
                    } else {
                        rewardCustom.value = '';
                    }
                });
            </script>
        </div>

        <div class="card">
            <h3 style="margin:0 0 6px 0;">Gift Codes</h3>
            <table>
                <thead>
                    <tr>
                        <th>Code</th><th>Reward</th><th>Max uses</th><th>Expires</th><th>Used By</th><th>Used At</th><th>Link</th>
                    </tr>
                </thead>
                <tbody>
                {% for g in gifts %}
                    <tr>
                        <td>{{ g['code'] }}</td>
                        <td>{{ g['reward'] or '—' }}</td>
                        <td>{{ g['max_uses'] }}</td>
                        <td>{{ g['expires_at'] or '—' }}</td>
                        <td>{{ g['used_by'] or '—' }}</td>
                        <td>{{ g['used_at'] or '—' }}</td>
                        <td><code style="font-size:12px;">/redeem/{{ g['code'] }}</code></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
