{% extends "navbar.html" %}

{% block top %}
<style>
    body { background:#060606; color:#e5e5e5; }
    .admin-wrapper { display:flex; margin-top:70px; min-height: calc(100vh - 70px); }
    .admin-sidebar {
        width:220px;
        background:#0c0c0c;
        border-right:1px solid #1c1c1c;
        padding:18px 14px;
    }
    .sidebar-title { font-size:20px; font-weight:700; margin:0 0 18px 2px; color:#e8e8e8; }
    .sidebar-nav { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:6px; }
    .sidebar-nav a {
        display:flex; align-items:center; gap:10px;
        padding:9px 10px;
        color:#d0d0d0; text-decoration:none;
        background:#111; border:1px solid #1f1f1f; border-radius:4px;
        transition:background .15s ease,color .15s ease, border .15s ease;
    }
    .sidebar-nav a:hover { background:#181818; color:#fff; border-color:#2a2a2a; }
    .sidebar-nav a.active { background:#202020; color:#fff; border-color:#3a3a3a; }
    .admin-content { flex:1; padding:0 24px 32px 24px; }
    .card { background:#0f0f0f; border:1px solid #1f1f1f; border-radius:4px; padding:14px 16px; margin-bottom:18px; }
    .card h3 { margin:0 0 8px 0; font-weight:700; }
    .muted { color:#9a9a9a; font-size:13px; }
    .table-wrap { overflow-x:auto; }
    table.flags-table { width:100%; border-collapse:collapse; }
    table.flags-table thead tr { background:#262626; }
    table.flags-table th, table.flags-table td {
        padding:9px 10px;
        border-bottom:1px solid #1d1d1d;
        font-size:13px;
        vertical-align:middle;
    }
    table.flags-table tbody tr:nth-child(2n) { background:#0c0c0c; }
    table.flags-table tbody tr:nth-child(2n+1) { background:#121212; }
    .approved { color:#1bcc4f; font-weight:600; }
    .denied { color:#ff4b4b; font-weight:600; }
    .pending { color:#e0c514; font-weight:600; }
    .actions { display:flex; gap:6px; flex-wrap:wrap; }
    .btn-ghost {
        background:#1c1c1c;
        border:1px solid #2a2a2a;
        color:#e6e6e6;
        padding:6px 10px;
        border-radius:3px;
        cursor:pointer;
        font-size:12px;
    }
    .btn-ghost:hover { background:#242424; border-color:#3a3a3a; }
    @media(max-width:900px){
        .admin-wrapper{ flex-direction:column; }
        .admin-sidebar{ width:100%; border-right:none; border-bottom:1px solid #1c1c1c; }
    }
</style>
{% endblock %}

{% block bottom %}
<div class="admin-wrapper">
    <aside class="admin-sidebar">
        <div class="sidebar-title">ADMIN</div>
        <div class="muted" style="margin-bottom:12px;">Menu</div>
        <ul class="sidebar-nav">
            <li><a href="{{ url_for('index') }}"><span class="fa fa-home"></span>Home</a></li>
            <li><a href="{{ url_for('admin_dashboard') }}"><span class="fa fa-home"></span>HOA</a></li>
            <li><a href="{{ url_for('users') }}"><span class="fa fa-user"></span>Users</a></li>
            <li><a href="{{ url_for('admin_blacklist') }}"><span class="fa fa-ban"></span>Blacklist</a></li>
            <li><a class="active" href="{{ url_for('admin_flags') }}"><span class="fa fa-flag"></span>Flags</a></li>
            <li><a href="{{ url_for('admin_edits') }}"><span class="fa fa-edit"></span>Edits</a></li>
            <li><a href="{{ url_for('admin_logs') }}"><span class="fa fa-list"></span>Logs</a></li>
            <li><a href="{{ url_for('admin_gifts') }}"><span class="fa fa-gift"></span>Gifts</a></li>
            <li><a href="{{ url_for('admin_spam') }}"><span class="fa fa-bell-slash"></span>Chat Mutes</a></li>
            <li><a href="{{ url_for('admin_chat') }}"><span class="fa fa-commenting"></span>Chat</a></li>
            <li><a href="{{ url_for('settings') }}"><span class="fa fa-toggle-on"></span>Settings</a></li>
        </ul>
    </aside>

    <div class="admin-content">
        <div class="card">
            <h3>Flags</h3>
            <div class="muted">
                Pending: {{ flags|selectattr('status','eq','pending')|list|length }} &nbsp;•&nbsp;
                Checked: {{ flags|selectattr('status','ne','pending')|list|length }}
            </div>
        </div>

        <div class="card table-wrap">
            <table class="flags-table">
                <thead>
                    <tr>
                        <th style="width:18%;">Title</th>
                        <th>Reason</th>
                        <th style="width:11%;">Verdict</th>
                        <th style="width:16%;">Flagged At</th>
                        <th style="width:16%;">Reviewed At</th>
                        <th style="width:14%;">Reviewed By</th>
                        <th style="width:15%;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for f in flags %}
                    <tr>
                        <td><a href="{{ url_for('post', file=f['pastname']) }}">{{ f['pastname'] }}</a></td>
                        <td style="word-break:break-word;">{{ f['reason'] }}</td>
                        <td class="{% if f['status']=='approved' %}approved{% elif f['status']=='denied' %}denied{% else %}pending{% endif %}">
                            {{ f['status']|capitalize }}
                        </td>
                        <td>{{ f['created_at'] }}</td>
                        <td>{{ f['decided_at'] or '—' }}</td>
                        <td>{{ f['decided_name'] or '—' }}</td>
                        <td>
                            {% if f['status']=='pending' %}
                            <form method="post" action="{{ url_for('decide_flag', flag_id=f['id']) }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                                <div class="actions">
                                    <button name="decision" value="approved" class="btn-ghost">Approve</button>
                                    <button name="decision" value="denied" class="btn-ghost">Deny</button>
                                </div>
                            </form>
                            {% else %}
                                —
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
