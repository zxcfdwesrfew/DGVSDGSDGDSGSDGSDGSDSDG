<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redeem Gift | Ghostbin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/nav.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { background:#060606; color:#fff; margin:0; font-family:'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; }
        .wrap { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px; }
        .card { background:#0f0f0f; border:1px solid #222; padding:32px; max-width:420px; width:100%; text-align:center; }
        .icon { color:#7B2BF7; font-size:48px; margin-bottom:16px; }
        .title { font-size:22px; font-weight:700; margin-bottom:18px; }
        .btn { background:#7B2BF7; border:none; color:#fff; padding:12px 24px; font-size:15px; font-weight:700; cursor:pointer; width:100%; }
        .btn:disabled { opacity:0.6; cursor:not-allowed; }
        .status { margin-top:16px; font-size:14px; min-height:20px; }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="card">
            <div class="icon"><i class="fa-solid fa-tree"></i></div>
            <div class="title">Redeem Gift</div>
            <button id="claimBtn" class="btn">Redeem</button>
            <div id="status" class="status"></div>
        </div>
    </div>
    <script>
        const csrf = "{{ csrf_token }}";
        const giftCode = "{{ code }}";
        const statusEl = document.getElementById('status');
        const btn = document.getElementById('claimBtn');
        function setStatus(msg, ok=true){
            statusEl.textContent = msg;
            statusEl.style.color = ok ? '#39ff14' : '#ff5555';
        }
        btn.addEventListener('click', async ()=>{
            btn.disabled = true;
            setStatus('Processing...', true);
            try {
                const res = await fetch('/api/claimGift', {
                    method:'POST',
                    headers:{
                        'Content-Type':'application/json',
                        'X-CSRF-Token': csrf
                    },
                    body: JSON.stringify({code: giftCode})
                });
                const data = await res.json();
                if(data.success){
                    setStatus(data.message || 'Redeemed.');
                    setTimeout(()=>location.href='/', 1200);
                } else {
                    setStatus(data.error || 'Failed to redeem.', false);
                    btn.disabled = false;
                }
            } catch(e){
                setStatus('Network error. Try again.', false);
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
