{% extends "navbar.html" %}
{% block top %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>User Admin</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/legacy/index.css">
</head>
<body style="background:#060606;color:#e5e5e5;">
{% endblock %}
{% block bottom %}
<div class="container" style="margin-top:70px;">
    <h4>Manage {{ target['username'] }}</h4>
    {% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
    <p>Status: {{ target['status'] }}</p>
    <p>Joined: {{ target['datejoin'] }}</p>
    <h5>Profile</h5>
    <p>Bio: {{ profile['bio'] }}</p>
    <p>Username color: {{ profile['username_color'] }}</p>

    <hr>
    <h5>Roles</h5>
    <ul>
        {% for r in roles %}
        <li>{{ r['role'] }} ({{ r['created_at'] }})</li>
        {% endfor %}
    </ul>
    <form method="post">
        <input type="hidden" name="action" value="grant_role">
        <select name="role" class="form-control">
            {% for r in ['founder','admin','manager','mod','council','clique','rich','vip','criminal','companion','fbi','user'] %}
            <option value="{{ r }}">{{ r }}</option>
            {% endfor %}
        </select>
        <input class="form-control" name="reason" placeholder="Reason">
        <button class="btn btn-default" type="submit">Grant Role</button>
    </form>

    <hr>
    <h5>Badges</h5>
    {% if badges %}
    <ul>
        {% for b in badges %}
        <li>{{ b['name'] }} <small>({{ b['tooltip'] or 'badge' }})</small> • {{ b['created_at'] }}</li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No badges yet.</p>
    {% endif %}
    <form method="post">
        <input type="hidden" name="action" value="grant_badge">
        <input class="form-control" name="badge_name" placeholder="Badge name (e.g., Staff)">
        <input class="form-control" name="badge_tooltip" placeholder="Tooltip (optional)">
        <input class="form-control" name="badge_color" placeholder="Color (e.g., #202225)">
        <input class="form-control" name="badge_icon" placeholder="Icon URL (optional)">
        <button class="btn btn-default" type="submit">Grant Badge</button>
    </form>

    <hr>
    <h5>Password Reset</h5>
    <form method="post">
        <input type="hidden" name="action" value="generate_reset">
        <button class="btn btn-default" type="submit">Generate Reset Link</button>
    </form>
    <ul>
        {% for r in resets %}
        <li>{{ r['token'] }} (expires {{ r['expires_at'] }}, used: {{ r['used_at'] or 'no' }})</li>
        {% endfor %}
    </ul>

    <hr>
    <h5>Two Factor</h5>
    <p>Enabled: {{ 'Yes' if twofa['enabled'] else 'No' }}</p>

    <hr>
    <h5>Order history</h5>
    {% if orders %}
    <ul>
        {% for o in orders %}<li>{{ o['item'] }} - {{ o['amount'] }} ({{ o['created_at'] }})</li>{% endfor %}
    </ul>
    {% else %}<p>No orders found</p>{% endif %}

    <hr>
    <h5>Username history</h5>
    {% if uname_hist %}
    <ul>
        {% for u in uname_hist %}<li>{{ u['old_username'] }} → {{ u['new_username'] }} ({{ u['changed_at'] }})</li>{% endfor %}
    </ul>
    {% else %}<p>No previous usernames</p>{% endif %}

    <hr>
    <h5>Sessions</h5>
    <ul>
        {% for s in sessions_list %}
            <li>{{ s['ip'] }} | {{ s['ua'] }} | {{ s['last_seen'] }}</li>
        {% endfor %}
    </ul>

    <hr>
    <form method="post">
        <input type="hidden" name="action" value="lock">
        <button class="btn btn-default" type="submit">Lock Account</button>
    </form>
    <form method="post" style="margin-top:6px;">
        <input type="hidden" name="action" value="delete">
        <button class="btn btn-default" type="submit">Delete Account</button>
    </form>
</div>
</body>
</html>
{% endblock %}
