
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BIO Profile</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <style>
    body { background: #04050a; }
    .overlay-effects > * { position:absolute; inset:0; pointer-events:none; }
    .effect-crosses span { position:absolute; width:14px; height:2px; background:rgba(255,255,255,0.4); transform:rotate(45deg); animation: flash 1.8s infinite ease-in-out; }
    .effect-crosses span::after { content:''; position:absolute; inset:0; transform:rotate(90deg); background:inherit; }
    @keyframes flash { 0%,100%{opacity:0.2;} 50%{opacity:1;} }
    .effect-stars span { position:absolute; width:3px; height:3px; background:#fff; border-radius:50%; animation: fly 6s linear infinite; }
    @keyframes fly { from { transform: translateY(-10vh);} to { transform: translateY(110vh);} }
    .effect-rain span { position:absolute; width:1px; height:18px; background:rgba(255,255,255,0.4); animation: rain 1.2s linear infinite; }
    @keyframes rain { from { transform: translateY(-10vh); opacity:0;} to { transform: translateY(110vh); opacity:0.9;} }
    .effect-snow span { position:absolute; width:6px; height:6px; border-radius:50%; background:rgba(255,255,255,0.8); animation: snow 8s linear infinite; }
    @keyframes snow { from { transform: translateY(-10vh);} to { transform: translateY(110vh);} }
    .effect-shoot span { position:absolute; width:80px; height:2px; background:linear-gradient(90deg, rgba(255,255,255,0.8), transparent); animation: shoot 3s ease-in-out infinite; opacity:0.8; }
    @keyframes shoot { 0%{ transform:translate(-10vw,-10vh) rotate(30deg);} 50%{ transform:translate(60vw,40vh) rotate(30deg);} 100%{ transform:translate(120vw,90vh) rotate(30deg);} }
    .effect-oldtv::after { content:''; position:absolute; inset:0; background:repeating-linear-gradient(0deg, rgba(255,255,255,0.04), rgba(255,255,255,0.04) 1px, transparent 2px, transparent 4px); mix-blend-mode:soft-light; opacity:0.8; }
    .effect-glitch::after { content:''; position:absolute; inset:0; background:linear-gradient(90deg, rgba(255,0,0,0.2), rgba(0,255,255,0.2)); mix-blend-mode:screen; animation: glitchShift 1s infinite; }
    @keyframes glitchShift { 0%{transform:translate(0);} 33%{transform:translate(-5px,2px);} 66%{transform:translate(4px,-2px);} 100%{transform:translate(0);} }
    .effect-retro::after { content:''; position:absolute; inset:0; background:radial-gradient(circle at 20% 20%, rgba(255,0,128,0.12), transparent 30%), radial-gradient(circle at 80% 80%, rgba(0,200,255,0.12), transparent 25%); }
    .effect-night::after { content:''; position:absolute; inset:0; background:radial-gradient(circle at 20% 20%, rgba(255,255,255,0.05), transparent 35%), radial-gradient(circle at 70% 50%, rgba(255,255,255,0.07), transparent 30%); filter:blur(1px); }
    .effect-theme::after { content:''; position:absolute; inset:0; background:var(--theme-overlay, rgba(109,227,255,0.12)); }
    .effect-noise { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='0.14'/%3E%3C/svg%3E"); mix-blend-mode:soft-light; opacity:0.5; }
  </style>
</head>
<body>
  <video id="backdropVideo" class="backdrop-video" autoplay muted loop playsinline></video>
  <div id="backdrop" class="backdrop"></div>
  <div id="overlayEffects" class="overlay-effects"></div>
  <canvas id="effectCanvas" class="overlay-canvas"></canvas>
  <div id="noiseOverlay" class="noise" style="display:none;"></div>

  <div class="overlay-screen" id="enterOverlay">
    <div class="cta" id="enterText">Click Enter</div>
  </div>

  <div class="profile-shell blurred" id="profileShell">
    <div class="bio-card tilt" id="bioCard">
      <div class="glow-edge" id="glowEdge"></div>
      <img id="banner" class="banner" alt="banner" style="display:none;">
      <video id="bannerVideo" class="banner" style="display:none;" autoplay muted loop playsinline></video>
      <div class="bio-top">
        <div class="avatar-wrap">
          <img id="avatar" class="bio-avatar" alt="avatar">
          <video id="avatarVideo" class="bio-avatar" style="display:none;" autoplay muted loop playsinline></video>
        </div>
        <div class="bio-meta" id="bioMeta">
          <div class="name-row" id="nameRow">
            <h2 id="username" class="username">username</h2>
            <div id="uidTip" class="uid-tip"></div>
            <img id="sparkles" class="sparkle" alt="sparkles" style="display:none;">
          </div>
          <div class="sub" id="alias"></div>
          <div class="sub" id="locationDefault"></div>
          <div class="sub" id="viewsInline"></div>
        </div>
      </div>
      <div id="titleLine" style="margin-top:10px; font-weight:600;"></div>
      <div id="badgeCluster" class="badge-box">
        <div class="join-date" id="joinDate"></div>
        <div id="badges" class="badge-row"></div>
      </div>
      <p id="bioText" style="margin-top:12px; color: var(--muted);"></p>
      <div class="bio-links" id="links"></div>
      <div id="audioInline" class="player-inline"></div>
    </div>
  </div>

  <div id="viewsWidget" class="widget" style="display:none;"></div>
  <div id="locationWidget" class="widget" style="display:none;"></div>
  <div id="audioWidget" class="audio-player player-top" style="display:none;"></div>
  <div id="watermark" class="watermark" aria-hidden="true">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" class="fill-theme drop-shadow-theme"><path d="M18 1l-6 4-6-4-6 5v7l12 10 12-10v-7z"></path></svg>
    <span class="wm-text">Made by fakewanted.lol</span>
  </div>

  <script>
    const qs = (id) => document.getElementById(id);
    const username = decodeURIComponent(location.pathname.split('/u/')[1] || '').replace(/\/$/, '');
    const state = { user: null, audio: null };

    const iconMap = {
      twitter: 'fa-brands fa-x-twitter',
      x: 'fa-brands fa-x-twitter',
      telegram: 'fa-brands fa-telegram',
      discord: 'fa-brands fa-discord',
      instagram: 'fa-brands fa-instagram',
      youtube: 'fa-brands fa-youtube',
      github: 'fa-brands fa-github',
      tiktok: 'fa-brands fa-tiktok',
      mail: 'fa-solid fa-envelope',
      phone: 'fa-solid fa-phone',
      link: 'fa-solid fa-link'
    };
    const createFavicon = (url) => {
      if (!url) return;
      let link = document.querySelector('link[rel="icon"]');
      if (!link) {
        link = document.createElement('link');
        link.rel = 'icon';
        document.head.appendChild(link);
      }
      link.href = url;
    };
    const locationIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="4 2 16 20" style="vertical-align:-2px; margin-right:6px;"><path fill="currentColor" d="M12 12q.825 0 1.413-.587T14 10t-.587-1.412T12 8t-1.412.588T10 10t.588 1.413T12 12m0 10q-4.025-3.425-6.012-6.362T4 10.2q0-3.75 2.413-5.975T12 2t5.588 2.225T20 10.2q0 2.5-1.987 5.438T12 22"></path></svg>`;

    const hexToRgb = (hex) => {
      const cleaned = hex.replace('#', '');
      const bigint = parseInt(cleaned.length === 3 ? cleaned.split('').map(c => c + c).join('') : cleaned, 16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return [r, g, b];
    };
    const isVideo = (file) => /\.(mp4|webm|mov|m4v|mkv)(\?.*)?$/i.test(file || '');

    function applyOpacity(color, opacity) {
      if (!color) return `rgba(255,255,255,${(opacity ?? 100) / 100})`;
      if (color.startsWith('rgba')) {
        const parts = color.replace(/rgba?\(|\)/g, '').split(',').map(s => s.trim());
        const [r,g,b] = parts;
        const alpha = (opacity ?? 100) / 100;
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
      }
      const [r,g,b] = hexToRgb(color || '#ffffff');
      return `rgba(${r}, ${g}, ${b}, ${(opacity ?? 100) / 100})`;
    }

    function setMeta(title, desc) {
      if (title) document.title = title;
      if (desc) {
        let m = document.querySelector('meta[name="description"]');
        if (!m) {
          m = document.createElement('meta');
          m.name = 'description';
          document.head.appendChild(m);
        }
        m.content = desc;
      }
    }

    function applyLayout(layout) {
      document.body.classList.remove('layout-left', 'layout-center');
      if (layout === 'left') document.body.classList.add('layout-left');
      if (layout === 'center') document.body.classList.add('layout-center');
    }

    function applyTitle(title, anim, speed) {
      const el = qs('titleLine');
      el.innerHTML = '';
      el.style.animation = '';
      if (!title) return;
      if (anim === 'wave') {
        const frag = document.createDocumentFragment();
        title.split('').forEach((ch, i) => {
          const span = document.createElement('span');
          span.textContent = ch;
          span.style.animationDelay = `${(speed || 300) / 1000 * (i * 0.05)}s`;
          frag.appendChild(span);
        });
        el.className = 'wave';
        el.appendChild(frag);
      } else if (anim === 'typewriter') {
        let idx = 0;
        el.textContent = '';
        const interval = setInterval(() => {
          el.textContent = title.slice(0, idx++);
          if (idx > title.length) clearInterval(interval);
        }, Math.max(50, speed || 120));
      } else if (anim === 'scrollLeft' || anim === 'marquee') {
        el.className = 'ticker';
        const span = document.createElement('span');
        span.textContent = title;
        el.appendChild(span);
      } else if (anim === 'glitch') {
        el.className = 'title-glitch';
        el.textContent = title;
      } else if (anim === 'swap') {
        el.className = 'swap';
        el.textContent = title;
      } else {
        el.className = '';
        el.textContent = title;
      }
    }

    function applyOverlayEffect(name, themeColor) {
      const container = qs('overlayEffects');
      container.innerHTML = '';
      qs('noiseOverlay').style.display = name === 'noise' ? 'block' : 'none';
      document.documentElement.style.setProperty('--theme-overlay', applyOpacity(themeColor || '#6de3ff', 0.18));
      if (!name || name === 'none') return;
      const classMap = {
        glitch: 'overlay-effects effect-glitch',
        retro: 'overlay-effects effect-retro',
        night: 'overlay-effects effect-night',
        oldtv: 'overlay-effects effect-oldtv',
        theme: 'overlay-effects effect-theme',
        cyberpunk: 'overlay-effects effect-retro effect-glitch'
      };
      container.className = classMap[name] || 'overlay-effects';

      const spawn = (cls, count, minDur = 4, maxDur = 10) => {
        const layer = document.createElement('div');
        layer.className = cls;
        for (let i = 0; i < count; i++) {
          const s = document.createElement('span');
          s.style.left = Math.random() * 100 + '%';
          s.style.top = Math.random() * 100 + '%';
          const dur = (Math.random() * (maxDur - minDur) + minDur).toFixed(2);
          const delay = (Math.random() * maxDur).toFixed(2);
          s.style.animationDuration = `${dur}s`;
          s.style.animationDelay = `-${delay}s`;
          layer.appendChild(s);
        }
        container.appendChild(layer);
      };

      if (name === 'flashing') spawn('effect-crosses', 60, 1.2, 2.4);
      if (name === 'flying') spawn('effect-stars', 90, 6, 12);
      if (name === 'rain') spawn('effect-rain', 120, 1.5, 3.2);
      if (name === 'snow') spawn('effect-snow', 100, 6, 12);
      if (name === 'shooting') spawn('effect-shoot', 8, 2.5, 5);
      if (name === 'cyberpunk') spawn('effect-retro', 0);
    }
    function applyCursor(cursor, trail) {
      // clear previous handlers
      window._cursorState = window._cursorState || {};
      if (window._cursorState.trailHandler) {
        document.removeEventListener('mousemove', window._cursorState.trailHandler);
        window._cursorState.trailHandler = null;
      }
      if (window._cursorState.catMove) {
        document.removeEventListener('mousemove', window._cursorState.catMove);
        window._cursorState.catMove = null;
      }
      if (window._cursorState.catTimer) {
        clearInterval(window._cursorState.catTimer);
        window._cursorState.catTimer = null;
      }
      document.body.style.cursor = 'auto';
      const existingCat = qs('catCursor');
      if (existingCat) existingCat.remove();
      if (cursor === 'custom') {
        const svg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24'><circle cx='8' cy='8' r='6' fill='%23${(state.user?.profile?.themeColor||'#6de3ff').replace('#','')}'/></svg>`);
        document.body.style.cursor = `url("data:image/svg+xml,${svg}") 4 4, auto`;
      } else if (cursor === 'trail' || trail !== 'none') {
        const handler = (e) => {
          const dot = document.createElement('div');
          dot.style.position = 'fixed';
          dot.style.left = e.clientX + 'px';
          dot.style.top = e.clientY + 'px';
          dot.style.width = '10px';
          dot.style.height = '10px';
          dot.style.borderRadius = '50%';
          dot.style.pointerEvents = 'none';
          dot.style.background = trail === 'particles' ? 'rgba(255,255,255,0.8)' : applyOpacity(state.user?.profile?.themeColor || '#6de3ff', 0.8);
          dot.style.boxShadow = '0 0 12px rgba(255,255,255,0.5)';
          dot.style.transform = 'translate(-50%,-50%)';
          dot.style.zIndex = 50;
          document.body.appendChild(dot);
          setTimeout(() => dot.remove(), 600);
        };
        window._cursorState.trailHandler = handler;
        document.addEventListener('mousemove', handler);
      } else if (cursor === 'cat') {
        const cat = document.createElement('div');
        cat.id = 'catCursor';
        cat.textContent = '😺';
        cat.style.position = 'fixed';
        cat.style.pointerEvents = 'none';
        cat.style.fontSize = '24px';
        cat.style.zIndex = 60;
        document.body.appendChild(cat);
        let pos = { x: innerWidth / 2, y: innerHeight / 2 };
        const move = (e) => { pos = { x: e.clientX, y: e.clientY }; };
        document.addEventListener('mousemove', move);
        window._cursorState.catMove = move;
        window._cursorState.catTimer = setInterval(() => {
          const catPos = cat.getBoundingClientRect();
          const dx = (pos.x - catPos.x) * 0.2;
          const dy = (pos.y - catPos.y) * 0.2;
          cat.style.transform = `translate(${catPos.x + dx}px, ${catPos.y + dy}px)`;
        }, 30);
      }
    }

    function applySparkles(color, user) {
      const el = qs('sparkles');
      if (!color || color === 'none') { el.style.display = 'none'; return; }
      el.src = `/api/sparkle/${color}?user=${encodeURIComponent(user)}`;
      el.style.display = 'block';
    }

    const badgeIcons = {
      'staff': '<svg viewBox=\"2.3 2 19.39 20\" width=\"23\" height=\"23\"><path fill=\"#999999\" d=\"m16.06 13.09l5.63 5.59l-3.32 3.28l-5.59-5.59v-.92l2.36-2.36h.92m.91-2.53L16 9.6l-4.79 4.8v1.97L5.58 22L2.3 18.68l5.59-5.59h1.97l.78-.78L6.8 8.46H5.5L2.69 5.62L5.31 3l2.8 2.8v1.31L12 10.95l2.66-2.66l-.96-1.01L15 5.97h-2.66l-.65-.65L15 2l.66.66v2.66L16.97 4l3.28 3.28c1.09 1.1 1.09 2.89 0 3.98l-1.97-2.01l-1.31 1.31Z\"></path></svg>',
      'server booster': '<svg viewBox=\"4.99 3 14 18\" width=\"23\" height=\"23\"><path fill=\"#999999\" d=\"M17.66 11.2c-.23-.3-.51-.56-.77-.82c-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32c-2.59 2.08-3.61 5.75-2.39 8.9c.04.1.08.2.08.33c0 .22-.15.42-.35.5c-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5c.14.6.41 1.2.71 1.73c1.08 1.73 2.95 2.97 4.96 3.22c2.14.27 4.43-.12 6.07-1.6c1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6c-1.12.4-2.24-.16-2.9-.82c1.19-.28 1.9-1.16 2.11-2.05c.17-.8-.15-1.46-.28-2.23c-.12-.74-.1-1.37.17-2.06c.19.38.39.76.63 1.06c.77 1 1.98 1.44 2.24 2.8c.04.14.06.28.06.43c.03.82-.33 1.72-.93 2.27Z\"></path></svg>',
      'the million': '<svg viewBox=\"2.01 1 20.99 21\" width=\"23\" height=\"23\"><path d=\"M23 7a8.44 8.44 0 0 0-5 1.31c-.36-.41-.73-.82-1.12-1.21l-.29-.27l.14-.12a3.15 3.15 0 0 0 .9-3.49A3.9 3.9 0 0 0 14 1v2a2 2 0 0 1 1.76 1c.17.4 0 .84-.47 1.31l-.23.21a16.71 16.71 0 0 0-3.41-2.2c-2.53-1.14-3.83-.61-4.47 0a2.18 2.18 0 0 0-.46.68l-.18.53L5.1 8.87C6.24 11.71 9 16.76 15 18.94l5-1.66a1 1 0 0 0 .43-.31l.21-.18c1.43-1.44.51-4.21-1.41-6.9A6.63 6.63 0 0 1 23 9zm-3.79 8.37h-.06c-.69.37-3.55-.57-6.79-3.81c-.34-.34-.66-.67-.95-1c-.10-.11-.19-.23-.29-.35l-.53-.64l-.28-.39c-.14-.19-.28-.38-.40-.56s-.16-.26-.24-.39s-.22-.34-.31-.51s-.13-.24-.19-.37s-.17-.28-.23-.42s-.09-.23-.14-.34s-.11-.27-.15-.40S8.6 6 8.58 5.9s-.06-.24-.08-.34a2 2 0 0 1 0-.24a1.15 1.15 0 0 1 0-.26l.11-.31c.17-.18.91-.23 2.23.37a13.83 13.83 0 0 1 2.49 1.54A4.17 4.17 0 0 1 12 7v2a6.43 6.43 0 0 0 3-.94l.49.46c.44.43.83.86 1.19 1.27A5.31 5.31 0 0 0 16 13.2l2-.39a3.23 3.23 0 0 1 0-1.14c1.29 1.97 1.53 3.39 1.21 3.7z\" fill=\"#999999\"></path><path d=\"M4.4 11l-2.23 6.7A3.28 3.28 0 0 0 5.28 22a3.21 3.21 0 0 0 1-.17l6.52-2.17A18.7 18.7 0 0 1 4.4 11z\" fill=\"#999999\"></path></svg>',
      'developer': '<svg viewBox=\"0 0 250 250\" width=\"23\" height=\"23\"><path d=\"M162.88 25.95c7.88-1.68 15.31-3.44 22.8-4.9 5.2-1.03 7.97 1.82 9.34 6.56 2.6 9.05 6.02 17.94 7.64 27.16 1.19 6.74 4.3 10.18 10.46 11.82 10.39 2.77 14.76 3.42 9.94 18.45-1.6 4.99-.4 8.64 3.66 12.47 7.07 6.67 13.45 14.1 19.72 21.54 3.2 3.8 2.12 11.86-1.3 15.29-6.95 6.96-13.87 13.95-20.88 20.84-1.96 1.93-2.95 3.62-1.48 6.49 1.39 2.71 2.21 5.77 2.9 8.76 1 4.25.16 8.03-4.37 9.76-5.15 1.97-10.41 3.62-15.67 5.42-3.87 13.37-7.5 27.19-12.13 40.65-.8 2.29-6.18 4.8-8.93 4.3-13.09-2.37-25.99-5.8-39-8.64a6.7 6.7 0 0 0-4.95 1.14c-2.6 2.03-4.8 4.6-7.16 6.96-5.79 5.78-11.13 5.8-16.87.07-8.86-8.86-8.85-8.8-21.22-5.82a726 726 0 0 1-24.72 5.64c-6.48 1.33-9.66-.81-11.75-7.32-3.64-11.27-7.17-22.57-10.96-33.78a6.8 6.8 0 0 0-3.49-3.68c-3.28-1.34-6.84-1.97-10.23-3.07-6.59-2.15-9.69-6.75-6.67-12.75 4.56-9.05 2.16-14.96-5.27-20.74-5.1-3.96-9.1-9.3-13.96-13.58-3.44-3.04-4.63-6.32-4.48-10.84.1-3.46 1.13-5.84 3.57-8.18 7.2-6.93 14.16-14.13 21.3-21.12 1.84-1.8 2.76-3.24 1.43-5.97-1.4-2.87-2.03-6.15-2.86-9.28-1.32-5.09.88-8.93 6 10.68 2.77-.94 5.53-2.56 8.3-2.61 5.42-.1 6.17-4.15 7.31-7.65 3.51-10.79 6.63-21.7 10.07-32.5 1.75-5.5 4.77-7.03 10.08-5.64 11.79 3.08 23.55 6.26 35.39 9.1 1.72.4 4.21-.36 5.7-1.45 3.44-2.54 6.48-5.6 9.67-8.47 2.86-2.56 10.38-2.83 12.52.34 6.74 9.97 15.44 11.25 25.86 6.98 1.34-.54 2.84-.7 4.69-1.07m33.65 154c.28-.58.48-1.24.86-1.75 16.34-21.79 20.8-46.43 15.2-72.45-4.23-19.73-14.2-36.93-30.74-49.29-21.68-16.2-45.78-23.05-72.85-17.5-20.79 4.27-37.96 14-51.4 30.77-16.84 21.01-23.08 44.8-18.33 70.84 3.86 21.2 13.6 39.68 31.12 53.43 19.9 15.6 42.14 22.27 67.26 19 23.76-3.08 43.33-13.75 58.88-33.05\" fill=\"#999999\"></path><path d=\"M72.24 74.26c11.22-10.98 23.88-19.2 38.99-22.05 20.79-3.9 40.53-.31 57.84 12.47 16.7 12.33 27.37 28.35 30.07 49.52 2.45 19.23-.95 36.88-12.19 52.6-13.22 18.5-31.12 29.32-54.16 31.25-25.59 2.14-46.52-7.16-63.1-26.07-10.59-12.08-16.03-26.64-16.73-42.92-.74-17.07 2.78-32.85 13-46.81 1.94-2.64 4.02-5.16 6.28-7.99M135 92.5l-7.92-8.57c-1.85 1.22-3.27 1.84-4.27 2.86-11.34 11.49-22.46 23.2-34.02 34.46-3.19 3.1-2.56 4.49.08 7.24 12.03 12.54 23.83 25.3 35.5 37.75L166.64 124z\" fill=\"#999999\"></path></svg>',
      'christmas 2024': '<svg viewBox=\"0 0 14 14\" width=\"23\" height=\"23\"><path fill=\"#999999\" fill-rule=\"evenodd\" d=\"M6.98 0C8 0 8.986.32 9.804.907L8.046 3.632a1.615 1.615 0 0 0-2.217.081L2.845 2.511a.63.63 0 0 0-.094-.03A4.844 4.844 0 0 1 6.98 0M2.29 3.627a4.845 4.845 0 0 0-.156 1.22v1.076a1.615 1.615 0 0 0 3.231 0v-1.05L2.378 3.67a.629.629 0 0 1-.088-.043m6.306 1.458l2.134-3.31a4.846 4.846 0 0 1 1.097 3.071v1.27l-3.231 3.23v-4.26Zm0 6.03v1.27a1.616 1.616 0 0 0 3.23 0V7.884z\" clip-rule=\"evenodd\"></path></svg>',
      'easter 2025': '<svg viewBox=\"4.5 2 15 19.99\" width=\"23\" height=\"23\"><path fill=\"#999999\" d=\"M6.89 6.36C8.23 3.91 10 2 12 2s3.77 1.91 5.11 4.36c-.85.21-1.61.71-2.11 1.41a3.71 3.71 0 0 0-5.2-.8c-.3.22-.58.49-.8.8c-.5-.7-1.26-1.2-2.11-1.41M15 18.06l-3-3l-3 3l-3-3l-1.27 1.27a7.504 7.504 0 0 0 9.11 5.43a7.53 7.53 0 0 0 5.43-5.43L18 15.06zm-6-2.12l3-3l3 3l3-3l1.5 1.5c-.13-2.31-.7-4.58-1.69-6.68c-1.16.1-2.06 1.07-2.06 2.24h-1.5A2.25 2.25 0 0 0 12 7.75A2.25 2.25 0 0 0 9.75 10h-1.5c0-1.17-.9-2.14-2.06-2.24c-.99 2.1-1.56 4.37-1.69 6.68l1.5-1.5z\"></path></svg>',
      'domain legend': '<svg viewBox=\"2.18 2.38 19.77 19.77\" width=\"23\" height=\"23\"><path fill=\"#999999\" d=\"m2.45 10.575l4.2-4.2q.35-.35.825-.5t.975-.05l1.3.275Q8.4 7.7 7.625 9t-1.5 3.15zm5.125 2.275q.575-1.8 1.563-3.4t2.387-3q2.2-2.2 5.025-3.287t5.275-.663q.425 2.45-.65 5.275T17.9 12.8q-1.375 1.375-3 2.388t-3.425 1.587zm6.9-3q.575.575 1.413.575T17.3 9.85t.575-1.412t-.575-1.413t-1.412-.575t-1.413.575t-.575 1.413t.575 1.412m-.7 12.025l-1.6-3.675q1.85-.725 3.163-1.5t2.912-2.125l.25 1.3q.1.5-.05.988t-.5.837zM4.05 16.05q.875-.875 2.125-.888t2.125.863t.875 2.125t-.875 2.125q-.625.625-2.087 1.075t-4.038.8q.35-2.575.8-4.025T4.05 16.05\"></path></svg>',
      'og': '<svg viewBox=\"4.39 2 15.22 20.97\" width=\"23\" height=\"23\"><path fill=\"#999999\" d=\"m12 8.5l2.116 5.088l5.492.44l-4.184 3.585l1.278 5.36L12 20.1l-4.702 2.872l1.278-5.36l-4.184-3.584l5.492-.44L12 8.5ZM8 2v9H6V2h2Zm10 0v9h-2V2h2Zm-5 0v5h-2V2h2Z\"></path></svg>',
      'donor': '<svg viewBox=\"2.01 2.01 19.98 19.98\" width=\"23\" height=\"23\"><path d=\"M2.047 14.668a.994.994 0 0 0 .465.607l1.91 1.104v2.199a1 1 0 0 0 1 1h2.199l1.104 1.91a1.01 1.01 0 0 0 .866.5c.174 0 .347-.046.501-.135L12 20.75l1.91 1.104a1.001 1.001 0 0 0 1.366-.365l1.103-1.91h2.199a1 1 0 0 0 1-1V16.38l1.91-1.104a1 1 0 0 0 .365-1.367L20.75 12l1.104-1.908a1 1 0 0 0-.365-1.366l-1.91-1.104v-2.2a1 1 0 0 0-1-1H16.38l-1.103-1.909a1.008 1.008 0 0 0-.607-.466a.993.993 0 0 0-.759.1L12 3.25l-1.909-1.104a1 1 0 0 0-1.366.365l-1.104 1.91H5.422a1 1 0 0 0-1 1V7.62l-1.91 1.104a1.003 1.003 0 0 0-.365 1.368L3.251 12l-1.104 1.908a1.009 1.009 0 0 0-.1.76zM12 13c-3.48 0-4-1.879-4-3c0-1.287 1.029-2.583 3-2.915V6.012h2v1.109c1.734.41 2.4 1.853 2.4 2.879h-1l-1 .018C13.386 9.638 13.185 9 12 9c-1.299 0-2 .515-2 1c0 .374 0 1 2 1c3.48 0 4 1.879 4 3c0 1.287-1.029 2.583-3 2.915V18h-2v-1.08c-2.339-.367-3-2.003-3-2.92h2c.011.143.159 1 2 1c1.38 0 2-.585 2-1c0-.325 0-1-2-1z\" fill=\"#999999\"></path></svg>',
      'premium': '<svg viewBox=\"23 32 465 448\" width=\"23\" height=\"23\"><path fill=\"#999999\" d=\"M396.31 32H264l84.19 112.26L396.31 32zm-280.62 0l48.12 112.26L248 32H115.69zM256 74.67L192 160h128l-64-85.33zm166.95-23.61L376.26 160H488L422.95 51.06zm-333.9 0L23 160h112.74L89.05 51.06zM146.68 192H24l222.8 288h.53L146.68 192zm218.64 0L264.67 480h.53L488 192H365.32zm-35.93 0H182.61L256 400l73.39-208z\"></path></svg>',
      'verified': '<svg viewBox=\"1 1.5 22 21\" width=\"23\" height=\"23\"><path fill=\"#999999\" d=\"m8.6 22.5l-1.9-3.2l-3.6-.8l.35-3.7L1 12l2.45-2.8l-.35-3.7l3.6-.8l1.9-3.2L12 2.95l3.4-1.45l1.9 3.2l3.6.8l-.35 3.7L23 12l-2.45 2.8l.35 3.7l-3.6.8l-1.9 3.2l-3.4-1.45l-3.4 1.45Zm2.35-6.95L16.6 9.9l-1.4-1.45l-4.25 4.25l-2.15-2.1L7.4 12l3.55 3.55Z\"></path></svg>',
      'image host': '<svg viewBox=\"2 2 20 20\" width=\"23\" height=\"23\"><path fill=\"#999999\" d=\"M9.153 5.408C10.42 3.136 11.053 2 12 2c.947 0 1.58 1.136 2.847 3.408l.328.588c.36.646.54.969.82 1.182c.28.213.63.292 1.33.45l.636.144c2.46.557 3.689.835 3.982 1.776c.292.94-.546 1.921-2.223 3.882l-.434.507c-.476.557-.715.836-.822 1.18c-.107.345-.071.717.001 1.46l.066.677c.253 2.617.38 3.925-.386 4.506c-.766.582-1.918.051-4.22-1.009l-.597-.274c-.654-.302-.981-.452-1.328-.452c-.347 0-.674.15-1.329.452l-.595.274c-2.303 1.06-3.455 1.59-4.22 1.01c-.767-.582-.64-1.89-.387-4.507l.066-.676c.072-.744.108-1.116 0-1.46c-.106-.345-.345-.624-.821-1.18l-.434-.508c-1.677-1.96-2.515-2.941-2.223-3.882c.293-.941 1.523-1.22 3.983-1.776l.636-.144c.699-.158 1.048-.237 1.329-.45c.28-.213.46-.536.82-1.182l.328-.588Z\"></path></svg>',
      'gifter': '<svg viewBox=\"2 2 16 16\" width=\"23\" height=\"23\"><g fill=\"#999999\"><path fill-rule=\"evenodd\" d=\"M14 6a2.5 2.5 0 0 0-4-3a2.5 2.5 0 0 0-4 3H3.25C2.56 6 2 6.56 2 7.25v.5C2 8.44 2.56 9 3.25 9h6V6h1.5v3h6C17.44 9 18 8.44 18 7.25v-.5C18 6.56 17.44 6 16.75 6zm-1-1.5a1 1 0 0 1-1 1h-1v-1a1 1 0 1 1 2 0m-6 0a1 1 0 0 0 1 1h1v-1a1 1 0 0 0-2 0\" clip-rule=\"evenodd\"></path><path d=\"M9.25 10.5H3v4.75A2.75 2.75 0 0 0 5.75 18h3.5zm1.5 7.5v-7.5H17v4.75A2.75 2.75 0 0 1 14.25 18z\"></path></g></svg>',
      'crown': '<svg viewBox=\"2 2 20 20.75\" width=\"23\" height=\"23\"><g fill=\"#999999\"><path d=\"M22 8.162v.073c0 .86 0 1.291-.207 1.643c-.207.352-.584.561-1.336.98l-.793.44c.546-1.848.729-3.834.796-5.532l.01-.221l.002-.052c.651.226 1.017.395 1.245.711c.283.393.283.915.283 1.958Zm-20 0v.073c0 .86 0 1.291.207 1.643c.207.352.584.561 1.336.98l.794.44c-.547-1.848-.73-3.834-.797-5.532l-.01-.221l-.001-.052c-.652.226-1.018.395-1.246.711C2 6.597 2 7.12 2 8.162Z\"></path><path fill-rule=\"evenodd\" d=\"M16.377 2.347A26.373 26.373 0 0 0 12 2c-1.783 0-3.253.157-4.377.347c-1.139.192-1.708.288-2.184.874c-.475.586-.45 1.219-.4 2.485c.173 4.348 1.111 9.78 6.211 10.26V19.5H9.82a1 1 0 0 0-.98.804l-.19.946H6a.75.75 0 0 0 0 1.5h12a.75.75 0 0 0 0-1.5h-2.65l-.19-.946a1 1 0 0 0-.98-.804h-1.43v-3.534c5.1-.48 6.039-5.911 6.211-10.26c.05-1.266.076-1.9-.4-2.485c-.476-.586-1.045-.682-2.184-.874Zm-3.59 3.46a.75.75 0 0 1 .463.693v4a.75.75 0 0 1-1.5 0V8.31l-.22.22a.75.75 0 1 1-1.06-1.06l1.5-1.5a.75.75 0 0 1 .817-.163Z\" clip-rule=\"evenodd\"></path></g></svg>',
      'bug hunter': '<svg viewBox=\"4 3.41 16 17.59\" width=\"23\" height=\"23\"><path fill=\"#999999\" d=\"M19 8h-1.81a5.985 5.985 0 0 0-1.82-1.96l.93-.93a.996.996 0 1 0-1.41-1.41l-1.47 1.47C12.96 5.06 12.49 5 12 5s-.96.06-1.41.17L9.11 3.7A.996.996 0 1 0 7.7 5.11l.92.93C7.88 6.55 7.26 7.22 6.81 8H5c-.55 0-1 .45-1 1s.45 1 1 1h1.09c-.05.33-.09.66-.09 1v1H5c-.55 0-1 .45-1 1s.45 1 1 1h1v1c0 .34.04.67.09 1H5c-.55 0-1 .45-1 1s.45 1 1 1h1.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H19c.55 0 1-.45 1-1s-.45-1-1-1h-1.09c.05-.33.09-.66.09-1v-1h1c.55 0 1-.45 1-1s-.45-1-1-1h-1v-1c0-.34-.04-.67-.09-1H19c.55 0 1-.45 1-1s-.45-1-1-1m-6 8h-2c-.55 0-1-.45-1-1s.45-1 1-1h2c.55 0 1 .45 1 1s-.45 1-1 1m0-4h-2c-.55 0-1-.45-1-1s.45-1 1-1h2c.55 0 1 .45 1 1s-.45 1-1 1\"></path></svg>',
      'premium badge': '<svg viewBox=\"2 2 20 20\" width=\"23\" height=\"23\"><path fill=\"#999999\" d=\"M12 4l-1.41 1.41L12 6.83l1.41-1.42zM4 12l1.41-1.41L6.83 12l-1.42 1.41zM12 20l-1.41-1.41L12 17.17l1.41 1.42zM20 12l-1.41 1.41L17.17 12l1.42-1.41z\"></path></svg>',
      'million': '<svg viewBox=\"2.01 1 20.99 21\" width=\"23\" height=\"23\"><path d=\"M23 7a8.44 8.44 0 0 0-5 1.31c-.36-.41-.73-.82-1.12-1.21l-.29-.27l.14-.12a3.15 3.15 0 0 0 .9-3.49A3.9 3.9 0 0 0 14 1v2a2 2 0 0 1 1.76 1c.17.4 0 .84-.47 1.31l-.23.21a16.71 16.71 0 0 0-3.41-2.2c-2.53-1.14-3.83-.61-4.47 0a2.18 2.18 0 0 0-.46.68l-.18.53L5.1 8.87C6.24 11.71 9 16.76 15 18.94l5-1.66a1 1 0 0 0 .43-.31l.21-.18c1.43-1.44.51-4.21-1.41-6.9A6.63 6.63 0 0 1 23 9zm-3.79 8.37h-.06c-.69.37-3.55-.57-6.79-3.81c-.34-.34-.66-.67-.95-1c-.10-.11-.19-.23-.29-.35l-.53-.64l-.28-.39c-.14-.19-.28-.38-.40-.56s-.16-.26-.24-.39s-.22-.34-.31-.51s-.13-.24-.19-.37s-.17-.28-.23-.42s-.09-.23-.14-.34s-.11-.27-.15-.40S8.6 6 8.58 5.9s-.06-.24-.08-.34a2 2 0 0 1 0-.24a1.15 1.15 0 0 1 0-.26l.11-.31c.17-.18.91-.23 2.23.37a13.83 13.83 0 0 1 2.49 1.54A4.17 4.17 0 0 1 12 7v2a6.43 6.43 0 0 0 3-.94l.49.46c.44.43.83.86 1.19 1.27A5.31 5.31 0 0 0 16 13.2l2-.39a3.23 3.23 0 0 1 0-1.14c1.29 1.97 1.53 3.39 1.21 3.7z\" fill=\"#999999\"></path><path d=\"M4.4 11l-2.23 6.7A3.28 3.28 0 0 0 5.28 22a3.21 3.21 0 0 0 1-.17l6.52-2.17A18.7 18.7 0 0 1 4.4 11z\" fill=\"#999999\"></path></svg>'
    };

    function renderBadges(badges, premium) {
      const wrap = qs('badges');
      wrap.innerHTML = '';
      const aliasMap = {'booster':'server booster','imagehost':'image host','image host':'image host','premium badge':'premium','million':'the million'}; badges.forEach(rawName => {
        const name = String(rawName || '').trim();
        if (!name) return;
        const key = (aliasMap[name.toLowerCase()] || name.toLowerCase());
        const html = badgeIcons[key] || `<div class='pill'>${name}</div>`;
        const container = document.createElement('div');
        container.className = 'badge-container';
        container.innerHTML = html + `<span class=\"tooltip\">${name}</span>`;
        wrap.appendChild(container);
      });
    }

    function renderLinks(links, themeColor, textColor) {
      const wrap = qs('links');
      wrap.innerHTML = '';
      links.slice(0,25).forEach(link => {
        const href = link.type === 'mail' ? `mailto:${link.url}` : link.type === 'phone' ? `tel:${link.url}` : link.url;
        const item = document.createElement('a');
        item.href = href;
        item.target = '_blank';
        item.rel = 'noopener';
        item.className = 'link-block ' + (link.style || 'block');
        const iconClass = iconMap[link.icon?.toLowerCase()] || iconMap[link.type] || 'fa-solid fa-link';
        const iconHtml = link.image ? `<span class="link-icon"><img src="${link.image}" alt="icon"></span>` : `<span class="link-icon"><i class="${iconClass}"></i></span>`;
        item.innerHTML = `${iconHtml}<div><div>${link.title || link.url}</div><div class="tip">${link.tooltip || link.url}</div></div>`;
        wrap.appendChild(item);
      });
    }

    function buildAudio(tracks, position) {
      const inline = qs('audioInline');
      const floating = qs('audioWidget');
      inline.style.display = 'none';
      floating.style.display = 'none';
      inline.innerHTML = '';
      floating.innerHTML = '';
      if (!tracks.length) {
        if (state.audio) {
          state.audio.pause?.();
          state.audio = null;
        }
        return;
      }
      const hiddenOnly = position === 'off';
      const container = hiddenOnly ? inline : (position === 'belowCard' ? inline : floating);
      container.classList.remove('player-top', 'player-bottom');
      const audio = document.createElement('audio');
      audio.autoplay = false;
      audio.playsInline = true;
      audio.id = 'audioPlayer';
      audio.src = tracks[0].url;
      audio.loop = tracks.length === 1;
      audio.style.display = hiddenOnly ? 'none' : 'none';

      let currentIndex = 0;
      if (!hiddenOnly) {
        const ui = document.createElement('div');
        ui.className = 'audio-ui';

        const select = document.createElement('select');
        select.className = 'input slim';
        tracks.forEach((t, idx) => {
          const opt = document.createElement('option');
          opt.value = t.url;
          opt.textContent = t.title || `Track ${idx+1}`;
          select.appendChild(opt);
        });

        const playBtn = document.createElement('button');
        playBtn.type = 'button';
        playBtn.className = 'btn secondary tiny';
        playBtn.textContent = 'Play';

        const nextBtn = document.createElement('button');
        nextBtn.type = 'button';
        nextBtn.className = 'btn ghost tiny';
        nextBtn.textContent = 'Next';
        nextBtn.style.display = tracks.length > 1 ? 'inline-flex' : 'none';

        const progress = document.createElement('input');
        progress.type = 'range';
        progress.min = 0; progress.max = 100; progress.value = 0;
        progress.className = 'slider-track audio-progress';

        const timeLabel = document.createElement('div');
        timeLabel.className = 'pill';
        timeLabel.textContent = '0:00';

        const updateTime = () => {
          const cur = audio.currentTime || 0;
          const dur = audio.duration || 1;
          progress.value = Math.min(100, (cur / dur) * 100);
          const mins = Math.floor(cur / 60);
          const secs = Math.floor(cur % 60).toString().padStart(2, '0');
          timeLabel.textContent = `${mins}:${secs}`;
        };

        playBtn.addEventListener('click', () => {
          if (audio.paused) {
            audio.play().then(() => playBtn.textContent = 'Pause').catch(()=>{});
          } else {
            audio.pause();
            playBtn.textContent = 'Play';
          }
        });
        nextBtn.addEventListener('click', () => {
          if (tracks.length < 2) return;
          currentIndex = (currentIndex + 1) % tracks.length;
          select.selectedIndex = currentIndex;
          audio.src = tracks[currentIndex].url;
          if (state.entered) audio.play().then(()=> playBtn.textContent='Pause').catch(()=>{});
        });
        select.addEventListener('change', () => {
          currentIndex = select.selectedIndex;
          audio.loop = tracks.length === 1;
          audio.src = select.value;
          if (state.entered) audio.play().then(()=> playBtn.textContent='Pause').catch(()=>{});
        });
        audio.addEventListener('ended', () => {
          if (tracks.length > 1) {
            currentIndex = (currentIndex + 1) % tracks.length;
            select.selectedIndex = currentIndex;
            audio.src = tracks[currentIndex].url;
            if (state.entered) audio.play().then(()=> playBtn.textContent='Pause').catch(()=>{});
          } else {
            playBtn.textContent = 'Play';
          }
        });
        audio.addEventListener('timeupdate', updateTime);
        audio.addEventListener('loadedmetadata', updateTime);
        progress.addEventListener('input', () => {
          if (!audio.duration) return;
          const target = (progress.value / 100) * audio.duration;
          audio.currentTime = target;
        });

        ui.appendChild(select);
        ui.appendChild(playBtn);
        ui.appendChild(nextBtn);
        ui.appendChild(progress);
        ui.appendChild(timeLabel);
        container.appendChild(ui);
      }
      container.appendChild(audio);
      if (!hiddenOnly && position === 'top') container.classList.add('player-top');
      if (!hiddenOnly && position === 'bottom') container.classList.add('player-bottom');
      container.style.display = hiddenOnly ? 'none' : 'flex';
      state.audio = audio;
    }

    function placeWidgets(user) {
      const locWidget = qs('locationWidget');
      const locationText = user.profile?.location || '';
      if (locationText && user.widgets?.location !== 'default') {
        locWidget.innerHTML = locationIcon;
        const span = document.createElement('span');
        span.textContent = locationText;
        locWidget.appendChild(span);
        locWidget.className = 'widget ' + user.widgets.location;
        locWidget.style.display = 'block';
      } else {
        locWidget.style.display = 'none';
      }
    }
    function applyProfile(user) {
      state.user = user;
      const p = user.profile || {};
      setMeta(p.seoTitle || `${user.username} — BIO`, p.seoDescription || p.bio || 'BIO profile');
      applyLayout(user.layout || 'card');
      applyTitle(p.title || user.username, p.titleAnimation || 'none', p.titleAnimationSpeed || 300);
      applySparkles(p.sparkles, user.username);
      renderBadges(user.badges || [], user.premium);
      renderLinks(user.links || [], p.themeColor, p.primaryTextColor);
      const uidTip = qs('uidTip');
      const uidValue = user.uid || user.id || '';
      if (p.showUidTooltip !== false && uidValue) {
        uidTip.textContent = `UID: ${uidValue}`;
        uidTip.style.display = 'block';
      } else {
        uidTip.style.display = 'none';
      }
      createFavicon(p.faviconFile || '');

      if (p.font && p.font !== 'System') {
        document.body.style.fontFamily = `${p.font}, 'Space Grotesk', 'Inter', system-ui, sans-serif`;
      }
      document.documentElement.style.setProperty('--text', p.primaryTextColor || '#fff');
      document.documentElement.style.setProperty('--muted', p.secondaryTextColor || '#a7b1c5');
      document.documentElement.style.setProperty('--accent', p.themeColor || '#6de3ff');

      const backdropVideo = qs('backdropVideo');
      const backdrop = qs('backdrop');
      const useBgVideo = p.backgroundFile && isVideo(p.backgroundFile);
      const bgOpacity = (p.backgroundOpacity ?? 100) / 100;
      if (useBgVideo) {
        backdropVideo.src = p.backgroundFile;
        backdropVideo.style.display = 'block';
        backdropVideo.style.opacity = bgOpacity;
        backdropVideo.style.filter = `blur(${p.backgroundBlur || 0}px)`;
        backdropVideo.play().catch(()=>{});
        backdrop.style.backgroundImage = 'none';
        backdrop.style.opacity = 0;
        backdrop.style.backgroundColor = 'transparent';
      } else {
        backdropVideo.style.display = 'none';
        backdropVideo.pause?.();
        backdropVideo.removeAttribute('src');
        backdropVideo.load?.();
        if (p.backgroundFile) backdrop.style.backgroundImage = `url(${p.backgroundFile})`;
        else backdrop.style.backgroundImage = 'none';
        backdrop.style.opacity = bgOpacity;
        backdrop.style.backgroundColor = p.backgroundColor || '#000';
      }
      backdrop.style.filter = `blur(${p.backgroundBlur || 0}px)`;

      const banner = qs('banner');
      const bannerVideo = qs('bannerVideo');
      const useBannerVideo = p.bannerFile && isVideo(p.bannerFile);
      if (useBannerVideo) {
        bannerVideo.src = p.bannerFile;
        bannerVideo.style.display = 'block';
        bannerVideo.style.opacity = (p.bannerOpacity ?? 100) / 100;
        bannerVideo.style.filter = `blur(${p.bannerBlur || 0}px)`;
        bannerVideo.play().catch(()=>{});
        banner.style.display = 'none';
        banner.removeAttribute('src');
      } else if (p.bannerFile) {
        banner.src = p.bannerFile;
        banner.style.display = 'block';
        banner.style.opacity = (p.bannerOpacity ?? 100) / 100;
        banner.style.filter = `blur(${p.bannerBlur || 0}px)`;
        bannerVideo.style.display = 'none';
        bannerVideo.pause?.();
        bannerVideo.removeAttribute('src');
        bannerVideo.load?.();
      } else {
        banner.style.display = 'none';
        bannerVideo.style.display = 'none';
        bannerVideo.pause?.();
        bannerVideo.removeAttribute('src');
        bannerVideo.load?.();
      }

      const avatar = qs('avatar');
      const avatarVideo = qs('avatarVideo');
      const useAvatarVideo = p.avatarFile && isVideo(p.avatarFile);
      if (useAvatarVideo) {
        avatarVideo.src = p.avatarFile;
        avatarVideo.style.display = 'block';
        avatarVideo.style.borderRadius = `${p.avatarRadius ?? 50}%`;
        avatarVideo.style.objectFit = 'cover';
        avatarVideo.play().catch(()=>{});
        avatar.style.display = 'none';
      } else {
        avatar.src = p.avatarFile || 'https://placehold.co/240x240/111/FFF?text=avatar';
        avatar.style.display = 'block';
        avatarVideo.style.display = 'none';
        avatarVideo.pause?.();
        avatarVideo.removeAttribute('src');
        avatarVideo.load?.();
      }
      const avatarRadius = `${p.avatarRadius ?? 50}%`;
      avatar.style.borderRadius = avatarRadius;
      avatarVideo.style.borderRadius = avatarRadius;
      const avatarShadowRing = p.avatarDecoration === 'ring';
      if (avatarShadowRing) {
        const ring = applyOpacity(p.themeColor || '#6de3ff', 0.6);
        avatar.style.boxShadow = `0 0 0 4px ${ring}`;
        avatarVideo.style.boxShadow = `0 0 0 4px ${ring}`;
      } else if (p.avatarDecoration === 'shadow') {
        avatar.style.boxShadow = '0 10px 30px rgba(0,0,0,0.45)';
        avatarVideo.style.boxShadow = '0 10px 30px rgba(0,0,0,0.45)';
      } else {
        avatar.style.boxShadow = '';
        avatarVideo.style.boxShadow = '';
      }

      const card = qs('bioCard');
      card.style.maxWidth = (p.boxWidth || 440) + 'px';
      const cardBg = applyOpacity(p.boxColor || '#0c0e16', p.boxOpacity || 50);
      card.style.backgroundColor = cardBg;
      card.style.backgroundImage = 'none';
      card.style.borderRadius = (p.boxRadius || 10) + 'px';
      card.style.backdropFilter = `blur(${p.boxBlur || 0}px)`;
      card.style.border = `${p.borderWidth || 1}px ${p.borderStyle || 'solid'} ${applyOpacity(p.borderColor || '#78726D', p.borderOpacity || 20)}`;
      card.style.boxShadow = `0 15px 40px ${applyOpacity(p.shadowColor || '#303030', p.shadowOpacity || 0)}`;
      card.classList.toggle('tilt', p.boxTilt !== false && !p.parallaxEnabled);
      const glow = qs('glowEdge');
      if (glow) {
        const glowColor = applyOpacity(p.themeColor || p.boxColor || '#6de3ff', 0.35);
        glow.style.background = `linear-gradient(135deg, ${glowColor}, ${glowColor})`;
      }

      qs('username').textContent = user.username;
      qs('alias').textContent = user.alias || '';
      qs('bioText').textContent = p.bio || '';
      const locText = p.location || '';
      const locationDefault = qs('locationDefault');
      if (user.widgets?.location === 'default' && locText) {
        locationDefault.innerHTML = locationIcon;
        const span = document.createElement('span');
        span.textContent = locText;
        locationDefault.appendChild(span);
      } else {
        locationDefault.textContent = '';
      }
      qs('viewsInline').textContent = '';
      const join = qs('joinDate');
      if (join) {
        if (user.createdAt && p.showJoinDate !== false) {
          join.style.display = 'inline-flex';
          join.textContent = 'Joined ' + new Date(user.createdAt).toLocaleDateString();
        } else {
          join.style.display = 'none';
          join.textContent = '';
        }
      }
      const badgeCluster = qs('badgeCluster');
      const nameRow = qs('nameRow');
      const meta = qs('bioMeta');
      const hasBadges = (user.badges || []).length > 0;
      const showJoin = p.showJoinDate !== false && user.createdAt;
      badgeCluster.classList.remove('pos-side', 'pos-above', 'pos-below');
      if (!hasBadges && !showJoin) {
        badgeCluster.style.display = 'none';
        badgeCluster.remove();
      } else {
        badgeCluster.style.display = 'inline-flex';
        if (p.badgePosition === 'side') {
          badgeCluster.classList.add('pos-side');
          nameRow.appendChild(badgeCluster);
        } else if (p.badgePosition === 'above') {
          badgeCluster.classList.add('pos-above');
          meta.insertBefore(badgeCluster, nameRow);
        } else {
          badgeCluster.classList.add('pos-below');
          qs('alias').insertAdjacentElement('afterend', badgeCluster);
        }
      }

      applyOverlayEffect(p.overlay || 'none', p.themeColor);
      applyCursor(p.cursor || 'system', p.cursorTrail || 'none');
      applyParallax(p);

      const tracks = (p.music || []).filter(t => t.url);
      buildAudio(tracks, user.widgets?.audio || 'belowCard');
      placeWidgets(user);

      const overlay = qs('enterOverlay');
      const shell = qs('profileShell');
      overlay.style.display = 'grid';
      const overlayBg = p.enterBgColor || 'rgba(0,0,0,0.8)';
      overlay.style.background = overlayBg.startsWith('#') ? applyOpacity(overlayBg, 80) : overlayBg;
      const enterTextEl = qs('enterText');
      enterTextEl.style.color = p.enterTextColor || '#ffffff';
      enterTextEl.style.background = applyOpacity(p.themeColor || '#6de3ff', 0.18);
      enterTextEl.style.borderColor = applyOpacity(p.themeColor || '#6de3ff', 0.5);
      shell.style.filter = `blur(${p.revealBlur || 15}px)`;
      enterTextEl.textContent = p.revealText || 'Click Enter';
      const animationMap = {
        bounce: 'enter-bounce', wobble: 'enter-wobble', spin: 'enter-spin', slideUp: 'enter-slide-up', slideDown: 'enter-slide-down', slideLeft: 'enter-slide-left', slideRight: 'enter-slide-right', diagonalUp: 'enter-diagonal-up', diagonalDown: 'enter-diagonal-down', zoomIn: 'enter-zoom-in', zoomOut: 'enter-zoom-out'
      };
      const animationClass = animationMap[p.enterAnimation] || '';
      const startExperience = () => {
        if (state.entered) return;
        state.entered = true;
        overlay.classList.add('hidden');
        setTimeout(() => { overlay.style.display = 'none'; }, 400);
        shell.classList.remove('blurred');
        shell.style.filter = 'blur(0px)';
        if (animationClass) {
          card.style.setProperty('--speed', `${p.enterAnimationSpeed || 600}ms`);
          card.classList.add(animationClass);
          setTimeout(() => card.classList.remove(animationClass), (p.enterAnimationSpeed || 600) + 200);
        }
        if (state.audio) state.audio.play().catch(()=>{});
        const uidTip = qs('uidTip');
      };
      overlay.onclick = startExperience;
      // Start only after user clicks overlay
    }

    async function init() {
      if (!username) { qs('enterText').textContent = 'User not found'; return; }
      const res = await fetch(`/api/profile/${encodeURIComponent(username)}?increment=true`);
      const data = await res.json();
      if (!res.ok || !data.user) {
        qs('enterText').textContent = data.error || 'Profile not found';
        return;
      }
      applyProfile(data.user);
    }

    document.addEventListener('DOMContentLoaded', init);
    function applyParallax(config) {
      const enabled = Boolean(config?.parallaxEnabled);
      const intensity = Number(config?.parallaxIntensity ?? 10);
      const invert = Boolean(config?.parallaxInvert);
      const allowPointer = window.matchMedia('(hover: hover) and (pointer: fine)').matches;
      const card = qs('bioCard');
      const shell = qs('profileShell');
      const targets = [card, document.querySelector('.bio-top'), qs('links')].filter(Boolean);
      // cleanup previous listeners/loop
      if (card && card._parallaxHandlers) {
        const h = card._parallaxHandlers;
        card.removeEventListener('mousemove', h.move);
        card.removeEventListener('mouseleave', h.leave);
        window.removeEventListener('resize', h.resize);
        cancelAnimationFrame(h.rafId);
        card._parallaxHandlers = null;
      }
      targets.forEach(t => {
        t.style.transform = '';
        t.style.willChange = enabled ? 'transform' : 'auto';
        t.style.transformStyle = enabled ? 'preserve-3d' : 'flat';
      });
      if (!enabled || !allowPointer || !card) return;

      let rect = card.getBoundingClientRect();
      let targetRotX = 0, targetRotY = 0;
      let currentRotX = 0, currentRotY = 0;
      const maxRotate = Math.max(0, Math.min(20, intensity));

      const update = () => {
        currentRotX += (targetRotX - currentRotX) * 0.12;
        currentRotY += (targetRotY - currentRotY) * 0.12;
        const tx = currentRotY * (invert ? -1 : 1);
        const ty = currentRotX * (invert ? -1 : 1);
        targets.forEach(t => {
          t.style.transform = `perspective(1100px) rotateX(${ty}deg) rotateY(${tx}deg) translateZ(0px)`;
        });
        const h = card._parallaxHandlers;
        h.rafId = requestAnimationFrame(update);
      };

      const onMove = (e) => {
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const cx = rect.width / 2;
        const cy = rect.height / 2;
        targetRotY = ((x - cx) / cx) * maxRotate;
        targetRotX = ((y - cy) / cy) * -maxRotate;
      };

      const onLeave = () => {
        targetRotX = 0;
        targetRotY = 0;
      };

      const onResize = () => { rect = card.getBoundingClientRect(); };
      window.addEventListener('resize', onResize);
      card.addEventListener('mousemove', onMove);
      card.addEventListener('mouseleave', onLeave);
      card._parallaxHandlers = { move: onMove, leave: onLeave, resize: onResize, rafId: requestAnimationFrame(update) };
    }

  </script>
</body>
</html>
